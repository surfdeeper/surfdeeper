---
import Navigation from "../components/Navigation.astro";
import HeadMeta from "../components/HeadMeta.astro";
import GoogleAnalytics from "../components/GoogleAnalytics.astro";
import "../styles/design-system.css";

export interface Props {
  title: string;
  description?: string;
  editPath?: string;
  fullWidth?: boolean;
}

const {
  title,
  description = "Surf deeper. Learn more. Share what you know.",
  editPath,
  fullWidth = false,
} = Astro.props;

// Only show edit links when editPath is explicitly provided
const editBase = "https://github.com/surfdeeper/surfdeeper/edit/main/";
const editUrl = editPath ? editBase + editPath : null;

// Canonical URL - ensures Google knows the preferred URL
// Build it explicitly to avoid any issues with www subdomain
const path =
  Astro.url.pathname === "/" ? "" : Astro.url.pathname.replace(/\/$/, "");
const canonicalURL = `${Astro.site}${path}`;
---

<!doctype html>
<html lang="en">
  <head>
    <HeadMeta
      title={title}
      description={description}
      canonicalURL={canonicalURL}
    />
    <GoogleAnalytics />
  </head>
  <body>
    <Navigation />

    <main class={fullWidth ? "full-width" : ""}>
      <slot />
    </main>

    {
      editUrl && (
        <a
          class="edit-page-button"
          href={editUrl}
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Edit this page on GitHub"
          title="Edit this page"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
        </a>
      )
    }

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-logo">
          <img
            src="/logo-v2.png"
            alt="SurfDeeper logo"
            class="image-logo"
            width="180"
            height="108"
            onerror="this.onerror=null;this.src='/favicon.svg';"
          />
          <span>Surf Deeper</span>
        </div>
        <div class="footer-links">
          <div class="footer-section">
            <h4>üåä Ride the Wave</h4>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/guide">Guide</a></li>
              <li><a href="/maps">Map</a></li>
              <li><a href="/gallery">Gallery</a></li>
              <li><a href="/contribute">Contribute</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>üèÑ‚Äç‚ôÇÔ∏è Drop In</h4>
            <ul>
              <li><a href="/contribute">Share Knowledge</a></li>
              <li><a href="/maps">Add Spots</a></li>
              <li><a href="/guide">Submit Techniques</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-disclaimer">
          <h4>‚ö†Ô∏è Disclaimer</h4>
          <p>
            <strong>FOR ENTERTAINMENT AND INFORMATIONAL PURPOSES ONLY.</strong>
            Surfing is an inherently dangerous activity that carries significant
            risk of injury or death. Before attempting any surfing activity, consult
            with your physician and ensure you are in proper physical condition.
            All activities should be performed under adult supervision and guidance
            from qualified experts. By using this website, you acknowledge that you
            assume all risks and waive any claims against Surf Deeper, its contributors,
            and affiliates for any injuries, damages, or losses that may occur. This
            website provides no warranties or guarantees of any kind. Use at your
            own risk.
          </p>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 Surf Deeper. Community-driven surf knowledge.</p>
        </div>
      </div>
    </footer>
  </body><style>
    body {
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-lg);
      width: 100%;
      box-sizing: border-box;
    }

    /* Full width pages like guides, gallery */
    main.full-width {
      max-width: 1200px;
      padding: var(--space-lg) var(--space-md);
    }

    /* Footer Styles */
    .main-footer {
      background-color: var(--color-surface-secondary);
      border-top: 2px solid var(--color-accent);
      margin-top: auto;
    }

    .footer-container {
      max-width: var(--size-max-width);
      margin: 0 auto;
      padding: var(--space-lg);
    }

    .footer-logo {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-lg);
      color: var(--color-accent);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-xl);
    }

    .footer-logo .image-logo {
      width: 180px;
      height: auto;
      display: block;
    }

    .footer-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-lg);
    }

    .footer-section h4 {
      color: var(--color-accent);
      margin-bottom: var(--space-sm);
      font-size: var(--font-size-lg);
    }

    .footer-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .footer-section li {
      margin-bottom: var(--space-sm);
    }

    .footer-section a {
      color: var(--color-text-primary);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: var(--color-accent);
    }

    .footer-disclaimer {
      background-color: var(--color-surface-primary);
      border: 2px solid var(--color-surface-secondary);
      border-radius: var(--border-radius-lg);
      padding: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .footer-disclaimer h4 {
      color: var(--color-accent);
      margin: 0 0 var(--space-sm) 0;
      font-size: var(--font-size-base);
      text-align: center;
    }

    .footer-disclaimer p {
      color: var(--color-text-primary);
      margin: 0;
      font-size: var(--font-size-xs);
      line-height: var(--line-height-relaxed);
      text-align: center;
    }

    .footer-disclaimer strong {
      color: var(--color-accent);
      font-weight: var(--font-weight-bold);
    }

    .footer-bottom {
      border-top: 1px solid var(--color-border);
      padding-top: var(--space-4);
      text-align: center;
    }

    .footer-bottom p {
      color: var(--color-text-primary);
      margin: 0;
      font-size: var(--font-size-sm);
    }

    /* Leaflet Map Dark Theme - Prevent white flicker on tile load */
    :global(.leaflet-container) {
      background-color: var(--color-surface-primary) !important;
    }

    :global(.leaflet-tile-pane) {
      background-color: var(--color-surface-primary) !important;
    }

    :global(.leaflet-tile-container) {
      background-color: var(--color-surface-primary) !important;
    }

    :global(.leaflet-tile) {
      background-color: var(--color-surface-primary) !important;
    }

    :global(.dark-tiles) {
      background-color: var(--color-surface-primary) !important;
    }

    :global(.leaflet-pane) {
      background-color: transparent;
    }

    :global(.leaflet-map-pane) {
      background-color: var(--color-surface-primary);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      main {
        padding: 1rem;
      }

      .footer-container {
        padding: 1rem;
      }
    }

    /* Edit page button */
    .edit-page-button {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background-color: var(--color-surface-primary);
      border: 2px solid var(--color-surface-primary);
      color: var(--color-accent);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.3s ease;
      z-index: var(--z-dropdown);
      box-shadow: var(--shadow-base);
      opacity: 0.7;
    }

    .edit-page-button:hover {
      opacity: 1;
      background-color: var(--color-accent);
      color: var(--color-text-on-primary);
      border-color: var(--color-accent);
      transform: scale(1.1);
      box-shadow: var(--shadow-primary);
    }

    .edit-page-button:focus-visible {
      outline: 2px dashed var(--color-accent);
      outline-offset: 4px;
    }

    @media (max-width: 768px) {
      .edit-page-button {
        bottom: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
      }
    }
  </style>
</html>
