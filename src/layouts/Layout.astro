---
export interface Props {
  title: string;
  description?: string;
  editPath?: string;
}

const { title, description = "Surf deeper. Learn more. Share what you know.", editPath } = Astro.props;

// Only show edit links when editPath is explicitly provided
const editBase = 'https://github.com/surfdeeper/surfdeeper/edit/main/';
const editUrl = editPath ? editBase + editPath : null;

// Canonical URL - ensures Google knows the preferred URL
// Build it explicitly to avoid any issues with www subdomain
const path = Astro.url.pathname === '/' ? '' : Astro.url.pathname.replace(/\/$/, '');
const canonicalURL = `${Astro.site}${path}`;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <title>{title}</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4EL168HRYZ"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4EL168HRYZ');
    </script>
  </head>
  <body>
    <nav class="main-nav">
      <div class="nav-container">
        <a href="/" class="nav-logo" aria-label="Surf Deeper home">
          <span class="logo-crop">
            <img src="/logo.png?v=5" alt="SurfDeeper logo" class="image-logo" width="180" height="108" onerror="this.onerror=null;this.src='/favicon.svg';" />
          </span>
        </a>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/guide">Guide</a></li>
          <li><a href="/maps">Map</a></li>
          <li><a href="/contribute">Contribute</a></li>
            <li><a href="/gallery">Gallery</a></li>
        </ul>
      </div>
    </nav>

    <main>
      <slot />
    </main>

    {editUrl && (
      <a 
        class="edit-page-button" 
        href={editUrl} 
        target="_blank" 
        rel="noopener noreferrer"
        aria-label="Edit this page on GitHub"
        title="Edit this page"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
      </a>
    )}

    <footer class="main-footer">
      <div class="footer-container">
        <div class="footer-logo">
          <img src="/logo.png?v=5" alt="SurfDeeper logo" class="image-logo" width="180" height="108" onerror="this.onerror=null;this.src='/favicon.svg';" />
          <span>Surf Deeper</span>
        </div>
        <div class="footer-links">
          <div class="footer-section">
            <h4>üåä Ride the Wave</h4>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/guide">Guide</a></li>
              <li><a href="/maps">Map</a></li>
              <li><a href="/gallery">Gallery</a></li>
              <li><a href="/contribute">Contribute</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>üèÑ‚Äç‚ôÇÔ∏è Drop In</h4>
            <ul>
              <li><a href="/contribute">Share Knowledge</a></li>
              <li><a href="/maps">Add Spots</a></li>
              <li><a href="/guide">Submit Techniques</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-disclaimer">
          <h4>‚ö†Ô∏è Disclaimer</h4>
          <p>
            <strong>FOR ENTERTAINMENT AND INFORMATIONAL PURPOSES ONLY.</strong> 
            Surfing is an inherently dangerous activity that carries significant risk of injury or death. 
            Before attempting any surfing activity, consult with your physician and ensure you are in proper physical condition. 
            All activities should be performed under adult supervision and guidance from qualified experts. 
            By using this website, you acknowledge that you assume all risks and waive any claims against Surf Deeper, 
            its contributors, and affiliates for any injuries, damages, or losses that may occur. 
            This website provides no warranties or guarantees of any kind. Use at your own risk.
          </p>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 Surf Deeper. Community-driven surf knowledge.</p>
        </div>
      </div>
    </footer>
  </body>
</html>

<style>
  body {
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
    margin: 0;
    background-color: #0f172a;
    color: #00ff88;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  main {
    flex: 1;
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
    width: 100%;
    box-sizing: border-box;
  }

  /* Global link styles (apply to slotted content) */
  :global(a) {
    color: #00ff88;
    text-decoration: underline;
    text-decoration-color: #00cc6a;
    text-underline-offset: 3px;
    transition: color 0.3s ease;
  }

  :global(a:hover) {
    color: #00cc6a;
    text-decoration-color: #00ff88;
  }

  :global(a:visited) {
    color: #00ff88;
  }

  :global(a:focus-visible) {
    outline: 2px dashed #00ff88;
    outline-offset: 2px;
    border-radius: 2px;
  }

  /* Navigation Styles */
  .main-nav {
    background-color: #1e293b;
    border-bottom: 2px solid #00ff88;
    padding: 0.5rem 0;
    --nav-logo-height: 200px;
  }

  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: #00ff88;
    font-weight: 700;
    font-size: 1.25rem;
  }

  .nav-logo .logo-crop {
    display: block;
    height: auto;
    overflow: visible;
    line-height: 0;
  }

  .nav-logo .image-logo {
    max-height: var(--nav-logo-height);
    height: auto;
    width: auto;
    display: block;
    object-fit: contain;
    object-position: center;
  }

  .nav-links {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
  }

  .nav-links a {
    color: #00ff88;
    text-decoration: none;
    font-family: 'Roboto Mono', monospace;
    font-size: 1.1rem;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .nav-links a:hover {
    color: #00cc6a;
  }

  /* Footer Styles */
  .main-footer {
    background-color: #1e293b;
    border-top: 2px solid #00ff88;
    margin-top: auto;
  }

  .footer-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .footer-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    color: #00ff88;
    font-weight: 700;
    font-size: 1.25rem;
  }

  .footer-logo .image-logo {
    width: 180px;
    height: auto;
    display: block;
  }

  .footer-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .footer-section h4 {
    color: #00ff88;
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }

  .footer-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .footer-section li {
    margin-bottom: 0.5rem;
  }

  .footer-section a {
    color: #00ff88;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .footer-section a:hover {
    color: #00cc6a;
  }

  .footer-disclaimer {
    background-color: #0f172a;
    border: 2px solid #334155;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .footer-disclaimer h4 {
    color: #00ff88;
    margin: 0 0 0.75rem 0;
    font-size: 1rem;
    text-align: center;
  }

  .footer-disclaimer p {
    color: #94a3b8;
    margin: 0;
    font-size: 0.8rem;
    line-height: 1.6;
    text-align: center;
  }

  .footer-disclaimer strong {
    color: #00ff88;
    font-weight: 700;
  }

  .footer-bottom {
    border-top: 1px solid #334155;
    padding-top: 1rem;
    text-align: center;
  }

  .footer-bottom p {
    color: #94a3b8;
    margin: 0;
    font-size: 0.9rem;
  }

  /* Leaflet Map Dark Theme - Prevent white flicker on tile load */
  :global(.leaflet-container) {
    background-color: #1a1f2e !important;
  }

  :global(.leaflet-tile-pane) {
    background-color: #1a1f2e !important;
  }

  :global(.leaflet-tile-container) {
    background-color: #1a1f2e !important;
  }

  :global(.leaflet-tile) {
    background-color: #1a1f2e !important;
  }

  :global(.dark-tiles) {
    background-color: #1a1f2e !important;
  }

  :global(.leaflet-pane) {
    background-color: transparent;
  }

  :global(.leaflet-map-pane) {
    background-color: #1a1f2e;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .nav-container {
      flex-direction: column;
      gap: 1rem;
    }

    .nav-links {
      gap: 1rem;
    }

    .main {
      padding: 1rem;
    }

    .footer-container {
      padding: 1rem;
    }
    .main-nav { --nav-logo-height: 120px; }
  }

  /* Edit page button */
  .edit-page-button {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background-color: #1e293b;
    border: 2px solid #334155;
    color: #00ff88;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: all 0.3s ease;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    opacity: 0.7;
  }

  .edit-page-button:hover {
    opacity: 1;
    background-color: #00ff88;
    color: #0f172a;
    border-color: #00ff88;
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 255, 136, 0.4);
  }

  .edit-page-button:focus-visible {
    outline: 2px dashed #00ff88;
    outline-offset: 4px;
  }

  @media (max-width: 768px) {
    .edit-page-button {
      bottom: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
    }
  }
</style>
